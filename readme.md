## Sample Generated SVG
![nkjnsvs](tests/snippet-svg/generated.svg)

Image above was generated by calling:
```
GET /stats.svg?login=whoever&date=2021-08-16&days=15
```

## Run as Docker Container
This service requires mongodb as database. You can use dockerized mongodb like this one:
```sh
# change /my/own/datadir with correct directory to store data
# this configuration publishes port 27017 to system host
# it's recommended to use named internal docker network instead
docker run --name gh-revpoint-counter-db -p "27017:27017" -v /my/own/datadir:/data/db -d mongo:latest
```

Setup a `.env` file:
```sh
PORT=3000
MONGO_URL=mongodb://localhost:27017
MONGO_DATABASE=github-review-point-counter-test
```

Pull the latest docker image of github-review-point-counter:
```sh
docker pull arsfiqball/github-review-point-counter
```

Run the container:
```sh
# this configuration mount all network inside the container into system host
# it's recommended to use a gateway like nginx or traefik instead
docker run --rm --env-file .env --network host arsfiqball/github-review-point-counter:latest
```

## Setup Github Webhook
Go to Settings > Webhooks > Click `Add webhook` > Set payload URL with:
```
https://theapp.yourhost.com/webhook
```

On the option "Which events would you like to trigger this webhook?", select "Let me select individual events" and checkmark:
- Issue comments
- Pull request reviews

And click "Add webhook" button to submit.

## Generate SVG Image
Call the endpoint `GET /stats.svg` with the following required query parameters:
- login: Github username
- date: the end date to put in the graph
- days: how many days to rewind

Example:
```
GET https://myapp.ahost.com/stats.svg?login=whoever&date=2021-08-16&days=15
```


## How to Test
Make sure you have setup mongodb and configure MONGO_URL and MONGO_DATABASE environment variables with correct value.
You can use dockerized mongodb like this one:
```sh
# this mongodb does not associated with any volume
# data will be destroyed when the container is removed
docker run --rm -p "27017:27017" mongo:latest
```

Then run the test command:
```sh
npm test
```
